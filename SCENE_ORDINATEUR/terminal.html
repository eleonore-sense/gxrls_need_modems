<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8">
  <title>CodePen - Terminal Effect with TextArea</title>
  <link rel="stylesheet" href="./style.css">


<style>

body {
}

.terminal {
  width:40%;
  height:50px;
  background-color:cadetblue;
  color:black;
  font-size:13px;
  border: none;
  scroll-behavior: auto;
}

textarea:active{
  border: none;
}
</style>

</head>
<body>
<!-- partial:index.partial.html -->
<textarea class="terminal" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" id="terminal" cols="100" rows="100"></textarea>
<!-- partial -->
  <script >
    // global vars
let terminal, writeSpeed;

window.addEventListener('load', init);

function init() {
  // default settings
  terminal = document.getElementById("terminal");
  writeSpeed = 60;
  terminal.innerText = "[j.sammet@computing_corporation.a:]$ ";
  terminalStart();

  // input listener
  terminal.addEventListener("keydown", terminalInputHandler);
}

function terminalStart() {
  terminalWrite('\n>> ..............................................................\nLogin as Jean Sammet.............................................\nWelcome to the International Business Machines Corporation.......\nWait for connection..............................................\n.................................................................\nHé ho il y a quelqu’un·e?........................................\noui toi, devant l’ordinateur, c’est à toi que je parle!..........\ntu réalises une quête, c’est bien ça?............................\ntape [O] pour répondre [oui]......');
}


function terminalWrite(text) {
  let counter = 0;
  (function writer() {
    terminal.disabled = true;
      var textarea = document.getElementById("terminal");
  if(textarea.selectionStart == textarea.selectionEnd) {
     textarea.scrollTop = textarea.scrollHeight;
  }
  
    if (counter < text.length) {
      let terminalText = (`${(terminal.value).replace("|","")}${text.charAt(counter)}`);
      if (counter !== text.length-1) {
        terminalText = `${terminalText}|`
      }
      terminal.value = terminalText;
      counter++;
      setTimeout(writer, writeSpeed);
    } else {
      clearTimeout(writer);
      terminal.disabled = false;
      terminal.blur();
      terminal.focus();
    }
  })();
}

function terminalInputHandler(e) {
  console.log(e.keyCode);
  switch (e.keyCode) {
    case 79:
        terminalWrite('\n\nbien vien vien');
      break;
    case 78:
        terminalWrite('\nblabla');

      break;
    default:
      e.preventDefault();
      terminalWrite("\ncommande non prise en charge\ntape [O] pour répondre [oui]:");
  }
}
  </script>

</body>
</html>
